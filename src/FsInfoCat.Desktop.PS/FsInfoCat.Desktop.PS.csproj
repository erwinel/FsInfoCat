<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup>
        <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
        <Platform Condition=" '$(Platform)' == '' Or '$(Platform)' == 'Any CPU' ">AnyCPU</Platform>
        <AppendRuntimeIdentifierToOutputPath>false</AppendRuntimeIdentifierToOutputPath>
        <ProjectGuid>{7C4CC727-8001-4E91-BF15-A3814598C07B}</ProjectGuid>
        <RootNamespace>FsInfoCat.Desktop.PS</RootNamespace>
        <AssemblyName>FsInfoCat.PS</AssemblyName>
        <TargetFramework>net461</TargetFramework>
        <FsInfoCatDeploy>..\..\$(Configuration)\Desktop\FsInfoCat\</FsInfoCatDeploy>
        <Company>Leonard T. Erwine</Company>
        <AssemblyTitle>FS InfoCat PowerShell Library</AssemblyTitle>
        <Description>Supporting CLR Library for PowerShell Module FsInfoCat</Description>
        <Product>PowerShell Module FsInfoCat.PS</Product>
        <Copyright>Copyright © Leonard Thomas Erwine 2021</Copyright>
        <AssemblyVersion>0.1.0.0</AssemblyVersion>
        <FileVersion>0.1.0.0</FileVersion>
        <OsPlatform>Windows</OsPlatform>
    </PropertyGroup>

    <Choose>
        <When Condition=" '$(DefineConstants)' == '' ">
            <PropertyGroup>
                <DefineConstants>TRACE;NETFRAMEWORK</DefineConstants>
            </PropertyGroup>
        </When>
        <Otherwise>
            <PropertyGroup>
                <DefineConstants Condition="!$([System.Text.RegularExpressions.Regex]::IsMatch($(DefineConstants), '^(.*;)*TRACE(;.*)*$'))">$(DefineConstants);TRACE</DefineConstants>
                <DefineConstants Condition="!$([System.Text.RegularExpressions.Regex]::IsMatch($(DefineConstants), '^(.*;)*NETFRAMEWORK(;.*)*$'))">$(DefineConstants);NETFRAMEWORK</DefineConstants>
            </PropertyGroup>
        </Otherwise>
    </Choose>

    <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
        <DebugSymbols>true</DebugSymbols>
        <DebugType>full</DebugType>
        <Optimize>false</Optimize>
        <ErrorReport>prompt</ErrorReport>
        <WarningLevel>4</WarningLevel>
    </PropertyGroup>
    <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
        <DebugType>pdbonly</DebugType>
        <Optimize>true</Optimize>
        <ErrorReport>prompt</ErrorReport>
        <WarningLevel>4</WarningLevel>
    </PropertyGroup>

    <ItemGroup>
        <Compile Include="..\FsInfoCat.PS\**\*.cs" Exclude="..\FsInfoCat.PS\obj\**\*.*;..\FsInfoCat.PS\bin\**\*.*;Test/**/*.*">
            <Link>%(RecursiveDir)%(Filename)%(Extension)</Link>
        </Compile>
    </ItemGroup>
    <ItemGroup>
        <Content Include="..\FsInfoCat.PS\*.help.txt;..\FsInfoCat.PS\*.psd1;..\FsInfoCat.PS\*.psm1;..\FsInfoCat.PS\*.ps1" Exclude="..\FsInfoCat.PS\obj\**\*.*;..\FsInfoCat.PS\bin\**\*.*;Test/**/*.*">
            <CopyToOutputDirectory>Always</CopyToOutputDirectory>
            <Link>%(Filename)%(Extension)</Link>
        </Content>
    </ItemGroup>
    <ItemGroup>
        <ProjectReference Include="..\FsInfoCat.Desktop\FsInfoCat.Desktop.csproj" />
    </ItemGroup>
    <ItemGroup>
      <PackageReference Include="PowerShellStandard.Library" Version="5.1.1" />
      <PackageReference Include="System.ComponentModel.Annotations" Version="5.0.0" />
    </ItemGroup>

    <Target Name="PreBuild" AfterTargets="PreBuildEvent">
        <Exec Command="$(ProjectDir)..\..\dev\StandaloneT4Host\bin\Debug\net472\StandaloneT4Host.exe &quot;$(ProjectDir)..\FsInfoCat.PS\FsInfoCat.PS.csproj&quot;" />
    </Target>

    <Target Name="PostBuild" AfterTargets="PostBuildEvent">
        <Exec Condition=" !Exists('..\..\$(Configuration)') " Command="mkdir &quot;..\..\$(Configuration)&quot;" />
        <Exec Condition=" !Exists('..\..\$(Configuration)\Desktop') " Command="mkdir &quot;..\..\$(Configuration)\Desktop&quot;" />
        <Exec Condition=" !Exists('..\..\$(Configuration)\Desktop\FsInfoCat') " Command="mkdir &quot;..\..\$(Configuration)\Desktop\FsInfoCat&quot;" />
        <Exec Command="copy &quot;$(TargetDir)*.dll&quot; &quot;$(FsInfoCatDeploy)/&quot; /Y" />
        <Exec Command="copy &quot;$(TargetDir)*.pdb&quot; &quot;$(FsInfoCatDeploy)/&quot; /Y" />
        <Exec Command="copy &quot;$(TargetDir)*.psd1&quot; &quot;$(FsInfoCatDeploy)&quot; /Y" />
        <Exec Command="copy &quot;$(TargetDir)*.psm1&quot; &quot;$(FsInfoCatDeploy)&quot; /Y" />
        <Exec Command="copy &quot;$(TargetDir)*.help.txt&quot; &quot;$(FsInfoCatDeploy)&quot; /Y" />
    </Target>
</Project>
