<Project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="NetCoreBuild.xsd">
  <PropertyGroup>
    <FsInfoCatTrace>$(FsInfoCatTrace)
$(MSBuildThisFile) Top:
    MSBuildProjectDirectory = $(MSBuildProjectDirectory)
            TargetFramework = $(TargetFramework); AssemblyVersion = $(AssemblyVersion)
              Configuration = $(Configuration); DefineConstants = $(DefineConstants)
                 OutputPath = $(OutputPath); OsPlatform = $(OsPlatform)
          RepositoryRootDir = $(RepositoryRootDir); TargetFrameworkIdentifier = $(TargetFrameworkIdentifier)</FsInfoCatTrace>
  </PropertyGroup>
  <Choose>
    <When Condition=" $([MSBuild]::IsOsPlatform(`Windows`)) ">
      <PropertyGroup>
        <OsPlatform>Windows</OsPlatform>
        <DefineConstants Condition=" !$([System.Text.RegularExpressions.Regex]::IsMatch($(DefineConstants), '^(.*;)*WINDOWS(;.*)*$')) ">$(DefineConstants);WINDOWS</DefineConstants>
      </PropertyGroup>
    </When>
    <When Condition=" $([MSBuild]::IsOsPlatform(`OSX`)) ">
      <PropertyGroup>
        <OsPlatform>OSX</OsPlatform>
        <DefineConstants Condition=" !$([System.Text.RegularExpressions.Regex]::IsMatch($(DefineConstants), '^(.*;)*OSX(;.*)*$')) ">$(DefineConstants);OSX</DefineConstants>
      </PropertyGroup>
    </When>
    <Otherwise>
      <PropertyGroup>
        <OsPlatform>Linux</OsPlatform>
        <DefineConstants Condition=" !$([System.Text.RegularExpressions.Regex]::IsMatch($(DefineConstants), '^(.*;)*LINUX(;.*)*$')) ">$(DefineConstants);LINUX</DefineConstants>
      </PropertyGroup>
    </Otherwise>
  </Choose>
  <!-- <PropertyGroup Condition=" '$(Configuration)' == 'Debug' ">
    <DebugType>full</DebugType>
    <DefineConstants Condition=" !$([System.Text.RegularExpressions.Regex]::IsMatch($(DefineConstants), '^(.*;)*DEBUG(;.*)*$')) ">DEBUG;$(DefineConstants)</DefineConstants>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)' == 'Release' ">
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
    <DocumentationFile>bin\Release\FsInfoCat.PS.XML</DocumentationFile>
</PropertyGroup> -->
  <PropertyGroup>
    <FileVersion>$(AssemblyVersion)</FileVersion>
    <TargetFramework Condition=" '$(TargetFramework)' == '' ">netcoreapp3.1</TargetFramework>
    <DistroFrameworkIdentifier>$(TargetFramework.TrimEnd('.0123456789'))</DistroFrameworkIdentifier>
    <!-- <CodeAnalysisRuleSet>MinimumRecommendedRules.ruleset</CodeAnalysisRuleSet> -->
</PropertyGroup>
<Choose>
    <When Condition=" '$(DistroFrameworkIdentifier)' == 'net' ">
        <PropertyGroup>
            <DistroFrameworkIdentifier>NETFramework</DistroFrameworkIdentifier>
        </PropertyGroup>
    </When>
    <When Condition=" '$(DistroFrameworkIdentifier)' == 'netcoreapp' ">
        <PropertyGroup>
            <DistroFrameworkIdentifier>NETCore</DistroFrameworkIdentifier>
        </PropertyGroup>
    </When>
    <When Condition=" '$(DistroFrameworkIdentifier)' == 'netstandard' ">
        <PropertyGroup>
            <DistroFrameworkIdentifier>NETStandard</DistroFrameworkIdentifier>
        </PropertyGroup>
    </When>
</Choose>

<Choose>
    <When Condition=" $(TargetFrameworks.Contains(';')) And '$(DistroFrameworkIdentifier)' != 'NETStandard' ">
        <Choose>
          <When Condition=" '$(OsPlatform)' == 'OSX' ">
            <PropertyGroup>
              <AssemblyVersion>$(AssemblyVersion).3</AssemblyVersion>
            </PropertyGroup>
          </When>
          <When Condition=" '$(OsPlatform)' == 'Linux' ">
            <PropertyGroup>
              <AssemblyVersion>$(AssemblyVersion).2</AssemblyVersion>
            </PropertyGroup>
          </When>
          <When Condition=" '$(DistroFrameworkIdentifier)' == 'NETFramework' ">
              <PropertyGroup>
                <AssemblyVersion>$(AssemblyVersion).1</AssemblyVersion>
              </PropertyGroup>
          </When>
          <Otherwise>
              <PropertyGroup>
                <AssemblyVersion>$(AssemblyVersion).0</AssemblyVersion>
              </PropertyGroup>
          </Otherwise>
        </Choose>
    </When>
    <Otherwise>
        <Choose>
            <When Condition=" '$(DistroFrameworkIdentifier)' == 'NETFramework' ">
                <PropertyGroup>
                  <AssemblyVersion>$(AssemblyVersion).1</AssemblyVersion>
                </PropertyGroup>
            </When>
            <Otherwise>
                <PropertyGroup>
                  <AssemblyVersion>$(AssemblyVersion).0</AssemblyVersion>
                </PropertyGroup>
            </Otherwise>
        </Choose>
    </Otherwise>
  </Choose>
<PropertyGroup>
  <FsInfoCatTrace>$(FsInfoCatTrace)
$(MSBuildThisFile) Bottom:
  MSBuildProjectDirectory = $(MSBuildProjectDirectory)
          TargetFramework = $(TargetFramework); AssemblyVersion = $(AssemblyVersion)
            Configuration = $(Configuration); DefineConstants = $(DefineConstants)
               OutputPath = $(OutputPath); OsPlatform = $(OsPlatform)
        RepositoryRootDir = $(RepositoryRootDir); TargetFrameworkIdentifier = $(TargetFrameworkIdentifier)</FsInfoCatTrace>
</PropertyGroup>
</Project>
